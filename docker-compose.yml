version: '3.8'

services:
  mongo:
    image: mongo:5.0
    ports:
      - "27019:27017" # Avoid conflict with system MongoDB
    volumes:
      - mongo-data:/data/db
    restart: unless-stopped

  api:
    build:
      context: .
    image: task-manager-app
    ports:
      - "3002:3000"
    environment:
      - MONGO_URI=mongodb://mongo:27017/taskdb
    depends_on:
      - mongo
    restart: unless-stopped

volumes:
  mongo-data:

prometheus:
  image: prom/prometheus
  volumes:
    - ./prometheus.yml:/etc/prometheus/prometheus.yml
  ports:
    - "9090:9090"
